#include <stdio.h>
#include <dlfcn.h>
#include <stdlib.h>

int main(int argc, char **argv)
{
	void *p_handle;
	typedef void (*setname)();
	char *error;
	typedef char *(*getname)();
	setname ssetn = NULL;
	getname ggetn = NULL;

	p_handle = dlopen("libtest.so",RTLD_NOW|RTLD_GLOBAL);
	if(!p_handle) {
		fprintf(stderr, "%s\n", dlerror());
               	exit(EXIT_FAILURE);
	}
	dlerror();
	ssetn = dlsym(p_handle,"setname");
	ggetn = dlsym(p_handle,"getName");
	error = dlerror();
        if (error != NULL) {
        	fprintf(stderr, "%s\n", error);
               	exit(EXIT_FAILURE);
        }
	ssetn("hello,name");
	printf("name:\t%s\n",ggetn());
	dlclose(p_handle);
	exit(EXIT_SUCCESS);
	return 0;
}	
